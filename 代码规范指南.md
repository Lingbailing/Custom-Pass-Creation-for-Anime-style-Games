# 项目代码规范指南

## 项目概述
本项目是一个自定义动漫风格通行证创建工具，允许用户设计和导出游戏通行证。

## 已完成的优化

### 1. 核心文件优化

#### main.js - 主入口文件 ✓
- 添加完整的JSDoc注释
- 规范化模块导入顺序
- 优化事件处理函数
- 添加清晰的中文注释

#### js/update.js - 更新模块 ✓
- 简化刷新逻辑
- 移除冗余代码
- 优化页面加载流程
- 统一代码风格

#### js/console/main.js - 控制台主模块 ✓
- 添加模块说明
- 规范导入语句
- 添加功能描述注释

#### js/console/color.js - 颜色控制模块 ✓
- 完善函数注释
- 优化辅助函数
- 添加参数说明
- 规范变量命名

#### js/parser/fontList.js - 字体配置模块 ✓
- 添加JSDoc类型注释
- 提供使用示例
- 规范对象结构

## 代码规范标准

### 命名规范

```javascript
// 变量和函数 - 驼峰命名法
const userName = "张三";
function getUserInfo() {}

// 常量 - 全大写加下划线
const MAX_COUNT = 100;
const API_URL = "https://api.example.com";

// 类名 - 帕斯卡命名法
class UserManager {}

// 私有变量 - 下划线前缀
const _privateVar = "private";
```

### 注释规范

```javascript
/**
 * 函数功能描述
 * 
 * @author 作者名
 * @description 详细描述
 * @param {string} name - 参数说明
 * @returns {Object} 返回值说明
 */
function exampleFunction(name) {
  // 单行注释说明关键逻辑
  return { name };
}
```

### 文件头部注释模板

```javascript
/**
 * 模块名称
 * 模块功能的简要描述
 * 
 * @author 作者名
 * @description 详细的模块说明
 */
```

### 代码格式规范

1. **缩进**: 使用2个空格
2. **引号**: 统一使用双引号
3. **分号**: 语句结尾添加分号
4. **空行**: 函数之间空一行
5. **行宽**: 建议不超过100字符

### 函数编写规范

```javascript
/**
 * 函数应该单一职责
 * 函数名应该清晰表达功能
 */
function calculateTotal(items) {
  // 参数验证
  if (!items || !Array.isArray(items)) {
    return 0;
  }
  
  // 核心逻辑
  return items.reduce((sum, item) => sum + item.price, 0);
}
```

### 错误处理规范

```javascript
try {
  // 可能出错的代码
  const data = await fetchData();
  processData(data);
} catch (error) {
  // 记录错误
  console.error("数据处理失败:", error);
  // 用户友好的错误提示
  alert("操作失败，请重试");
}
```

## 性能优化建议

### 1. 防抖和节流

```javascript
// 防抖函数 - 用于输入框等频繁触发的事件
function debounce(func, wait) {
  let timeout;
  return function(...args) {
    clearTimeout(timeout);
    timeout = setTimeout(() => func.apply(this, args), wait);
  };
}

// 使用示例
const debouncedRender = debounce(() => {
  readTemplate(template, "ctx01");
}, 250);
```

### 2. 图片优化

```javascript
// 图片懒加载
const imageCache = new Map();

function loadImageWithCache(src) {
  if (imageCache.has(src)) {
    return Promise.resolve(imageCache.get(src));
  }
  
  return new Promise((resolve, reject) => {
    const img = new Image();
    img.onload = () => {
      imageCache.set(src, img);
      resolve(img);
    };
    img.onerror = reject;
    img.src = src;
  });
}
```

### 3. 减少DOM操作

```javascript
// 批量更新DOM
function updateMultipleElements(updates) {
  // 使用DocumentFragment减少重排
  const fragment = document.createDocumentFragment();
  updates.forEach(update => {
    const element = document.createElement(update.tag);
    element.textContent = update.text;
    fragment.appendChild(element);
  });
  container.appendChild(fragment);
}
```

## 待优化文件清单

### 高优先级
1. **js/parser/main.js** - 模板解析器核心文件
   - 添加完整注释
   - 优化渲染性能
   - 改进错误处理

2. **js/console/text.js** - 文本控制模块
   - 简化复杂逻辑
   - 优化字体加载
   - 添加详细注释

3. **js/console/image.js** - 图片控制模块
   - 优化图片处理
   - 改进条形码生成
   - 添加注释说明

### 中优先级
4. **js/export.js** - 导出功能模块
   - 优化导出逻辑
   - 改进错误处理
   - 添加进度提示

5. **assets/template.js** - 模板数据文件
   - 规范数据结构
   - 添加类型注释

### 低优先级
6. **css/main.css** - 样式文件
   - 优化CSS结构
   - 添加注释说明
   - 提取公共样式

7. **index.html** - 主页面
   - 优化HTML结构
   - 添加语义化标签
   - 改进可访问性

## 测试建议

### 单元测试示例

```javascript
// 使用Jest或Mocha进行单元测试
describe("颜色转换函数", () => {
  test("应该正确转换hex到rgba", () => {
    const result = hexToRgba("#ff0000", 0.5);
    expect(result).toBe("rgba(255, 0, 0, 0.5)");
  });
});
```

### 集成测试

```javascript
// 测试完整的工作流程
describe("通行证生成流程", () => {
  test("应该成功生成正面图片", async () => {
    // 设置测试数据
    template.layers[0].children[1].children[0].text = "测试";
    
    // 执行渲染
    await readTemplate(template, "ctx01");
    
    // 验证结果
    const canvas = document.getElementById("canvas01");
    expect(canvas).toBeTruthy();
  });
});
```

## Git提交规范

```bash
# 提交信息格式
<类型>: <简短描述>

<详细描述>

# 类型说明
feat: 新功能
fix: 修复bug
docs: 文档更新
style: 代码格式调整
refactor: 重构代码
perf: 性能优化
test: 测试相关
chore: 构建/工具相关

# 示例
feat: 添加条形码自定义功能

- 支持自定义条形码内容
- 支持调整条形码尺寸
- 添加透明背景选项
```

## 开发工具推荐

1. **ESLint** - 代码质量检查
2. **Prettier** - 代码格式化
3. **JSDoc** - 文档生成
4. **Jest** - 单元测试
5. **Webpack** - 模块打包

## 下一步行动计划

1. ✅ 完成核心文件优化（已完成5个文件）
2. ⏳ 继续优化剩余JavaScript文件
3. ⏳ 添加错误处理和日志系统
4. ⏳ 实现单元测试覆盖
5. ⏳ 优化性能和用户体验
6. ⏳ 编写完整的API文档

## 维护建议

1. **定期代码审查** - 每周检查代码质量
2. **性能监控** - 使用Performance API监控性能
3. **用户反馈** - 收集并处理用户反馈
4. **版本管理** - 使用语义化版本号
5. **文档更新** - 保持文档与代码同步

## 联系方式

- 原作者 QQ: 3412725994
- 原作者交流群: 1056969651
- GitHub: https://github.com/Lingbailing/Custom-Pass-Creation-for-Anime-style-Games

---

**最后更新**: 2026年1月2日
**版本**: v1.0
